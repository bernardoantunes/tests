<div id="asDesigned-interface">
	<div id="asDesigned-startIcon">
		<i class="icon-cog"></i>
	</div>
	<div id="asDesigned-dialog">
		<div id="asDesigned-caption">Settings</div>

        <!-- Author Screen data -->
        <fieldset id="basic-data-fieldset">
            <span class="add-on"><i class="icon-resize-full"></i></span>
            <input data-bind="value: screenSizeDiagonal" type="text" placeholder="Screen size"/>″<br/>
            <span class="add-on"><i class="icon-picture"></i></span>
            <select data-bind="options: devicesList, value: viewingDistance, optionsText: 'description', optionsValue: 'viewingDistance'"></select><br/>
        </fieldset>

        <!-- User Screen data -->
        <fieldset id="screen-resolution-fieldset">
            <span class="add-on"><i class="icon-move"></i></span>
            <i class="icon-resize-horizontal"></i><span data-bind="text: screenWidth"></span>
            <i class="icon-resize-vertical"></i><span data-bind="text: screenHeight"></span>
        </fieldset>

        <!-- User Custom Adjustments -->
        <fieldset id="custom-adjustments-fieldset">
            <span class="add-on"><i class="icon-eye-open"></i></span>
            <input data-bind="value: viewingDistance" type="text" placeholder="Viewing distance"/>″<br/>
            <span class="add-on"><i class="icon-search"></i></span>
            <input data-bind="value: userReadability" type="text" placeholder="Zoom adjustment"/><br/>
        </fieldset>

		<!-- User Screen data -->
		<fieldset style="display: none">
			<label for="screen-diagonal">Diagonal</label><input data-bind="value: screenDiagonal" type="text" id="screen-diagonal"/><br/>
			<br/>
			<label for="screen-definition">Definition</label><input data-bind="value: screenDefinition" type="text" id="screen-definition"/>dpi<br/>

            <legend>Result calculation data:</legend>
            <label for="screen-definition-ratio">Definition Ratio between the Author and the User</label>
            <input data-bind="value: screenDefinitionRatio" type="text" id="screen-definition-ratio"/><br/>

            <legend>Author screen data:</legend>
            <label for="author-screen-definition">Author ppi</label>
            <input data-bind="value: authorScreenDefinition" type="text" id="author-screen-definition"/><br/>

            <label for="author-viewing-distance">Author Viewing Distance</label>
            <input data-bind="value: authorViewingDistance" type="text" id="author-viewing-distance"/><br/>

            <legend>Viewing distance:</legend>
            <label for="viewing-diameter">Diameter</label>
            <input data-bind="value: screenSizeDiagonal" type="text" id="viewing-diameter"/><br/>
            <label for="viewing-angle">Angle</label>
            <input data-bind="value: viewingAngle" type="text" id="viewing-angle"/><br/>
            <label for="adjust-value">Adjust Value</label>
            <input data-bind="value: adjustValue" type="text" id="adjust-value"/><br/>
        </fieldset>
	</div>
</div>

<script type="text/javascript">

//Returns the viewing angle in degrees.
function calculateViewingAngle(distance, diameter)
{
    return 2 * Math.atan(diameter / (2 * distance) ) * 57.2957795;
}

//Class with the device information.
function DeviceInfo(description, viewingDistance)
{
    this.description = description;
    this.viewingDistance = viewingDistance;
}

// This is a simple *viewmodel* - JavaScript that defines the data and behavior of your UI
function AppViewModel()
{
    this.devicesList = [
        new DeviceInfo("none", -1),
        new DeviceInfo("SmartPhone", 15),
        new DeviceInfo("Tablet", 18),
        new DeviceInfo("Laptop", 20),
        new DeviceInfo("Desktop", 24),
        new DeviceInfo("TV", 0),
        new DeviceInfo("Other", 0)
        ];

    this.authorScreenDefinition = ko.observable(147.0230825775055);
    this.authorViewingDistance = ko.observable(20);

    this.userReadability = ko.observable(1);

    this.screenWidth = ko.observable(screen.width);
    this.screenHeight = ko.observable(screen.height);

    this.screenDiagonal = ko.computed(function() {
            return Math.sqrt(Math.pow(this.screenWidth(), 2) + Math.pow(this.screenHeight(), 2));
        }, this);
    
    this.screenSizeDiagonal = ko.observable(15.4);

    this.screenDefinition = ko.computed(function() {
            return this.screenDiagonal() / this.screenSizeDiagonal();
        }, this);

    //Now lets calculate the author/user ratio

    //For tests only REMOVE.
    this.viewingDistance = ko.observable(20);

    this.adjustValue = ko.computed(function() {
            return calculateViewingAngle(this.authorViewingDistance(), 1) /
                calculateViewingAngle(this.viewingDistance(), 1) *
                this.userReadability();
        }, this);

    this.screenDefinitionRatio = ko.computed(function() {
            return this.screenDefinition() / this.authorScreenDefinition() * this.adjustValue();
        }, this);
  
    this.viewingAngle = ko.computed(function() {
            return calculateViewingAngle(this.viewingDistance(), this.screenSizeDiagonal());
        }, this);

//        Screen Size     
//        1   15,4    3,5
//Viewing Distance        Angle       
//Device  cm  degrees     
//Desktop 24  2,386978848 35,57594508 8,34087305
//Laptop  20  2,864192368 42,11341118 10,0012892
//Tablet  18  3,182280542 46,32032553 11,10594207
//SmartPhone  12  4,771888061 65,37387308 16,59428994

//    this.capitalizeLastName = function() {
//            var currentVal = this.lastName();
//            // Read the current value
//            this.lastName(currentVal.toUpperCase());
//            
//            // Write back a modified value
//        };

//
//                           TODO:
//                        **********
//
// Q: Corrigir o problema de quando ponho pequeno e depois grande de novo
//    o layout nao fica como o original.
//
// Q: Verificar quando temos ecrans com diferentes aspect ratios
//    By example, designed in a 4:3 and viewed in a 16:9.
// A: Se nao se utilizar as dimensoes do ecran para fazer as contas
//    mas apenas a distancia, nada disso entra em questao.
//
// Q: Verificar porque e que com apenas um olho aberto as porporcoes parecem
//    correctas, mas quando se abre os dois tudo parece mais pequeno.
//

}

var appViewModel = new AppViewModel();

try {
    if(appViewModel.screenSizeDiagonal() != "") $('html').css('font-size', appViewModel.screenDefinitionRatio().toString() + 'em');
    if(appViewModel.viewingDistance() != "") updateMediaRulesEmByFactor(appViewModel.screenDefinitionRatio());
}
catch(e) { }

appViewModel.screenDefinitionRatio.subscribe(function (newValue) {
    try {    
        if(appViewModel.screenSizeDiagonal() != "") $('html').css('font-size', newValue.toString() + 'em');
        if(appViewModel.viewingDistance() != "") updateMediaRulesEmByFactor(newValue);
    }
    catch(e) { }
});

// Activates knockout.js
//ko.applyBindings(appViewModel);
</script>

<script type="text/javascript">
//This function activates the asDesigned interface.
function asDesigned()
{

var asDesignedStart =
    '<object style="width:100%;height:100%" type="image/svg+xml" data="/img/asDesigned/asDesigned-logo.svg">' +
        '<img style="width:100%;height:100%" src="/img/asDesigned/asDesigned-logo.png" alt="As Designed Logo">' +
    '</object>';
$("#asDesigned-placeholder").html(asDesignedStart);

}

asDesigned();

</script>